define(function(){"use strict";var e=function(u){u=u||{};var o={},l=Array.prototype.slice;Object.defineProperties(u,{on:{value:function(e,t){if(typeof t=="function"){(o[e]=o[e]||[]).push(t)}return u},enumerable:false,writable:false,configurable:false},off:{value:function(e,t){if(e=="*"&&!t){o={}}else{if(t){var n=o[e];for(var r=0,i;i=n&&n[r];++r){if(i==t){n.splice(r--,1)}}}else{delete o[e]}}return u},enumerable:false,writable:false,configurable:false},one:{value:function(e,t){function n(){u.off(e,n);t.apply(u,arguments)}return u.on(e,n)},enumerable:false,writable:false,configurable:false},trigger:{value:function(e){var t=arguments;var n=arguments.length-1,r=new Array(n),i,f,a;for(a=0;a<n;a++){r[a]=t[a+1]}i=l.call(o[e]||[],0);for(a=0;f=i[a];++a){f.apply(u,r)}if(o["*"]&&e!="*"){u.trigger.apply(u,["*",e].concat(r))}return u},enumerable:false,writable:false,configurable:false}});return u};var n=/^.+?\/\/+[^/]+/,t="EventListener",r="remove"+t,i="add"+t,f="hasAttribute",a="popstate",u="hashchange",o="trigger",l=3,c=typeof window!="undefined"&&window,s=typeof document!="undefined"&&document,h=c&&history,p=c&&(h.location||c.location),d=P.prototype,v=s&&s.ontouchstart?"touchstart":"click",m=e();var g=false,b=false,y,w,A,$,S,x=[],K=0;function N(e){return e.split(/[/?#]/)}function O(e,t){var n=t.match(/\/:(\w+)/g);var r=t.replace(/\?/g,"\\?").replace(/\*/g,"([^/?#]+?)").replace(/\.\./,".*").replace(/\/:\w+/g,"(\\/[a-zA-Z0-9_\\-\\+=:\\(\\)\\[\\]\\s+]+|)");var i=new RegExp("^"+r+"$");var f=e.match(i);if(f){if(n){var a={};for(var u=0;u<n.length;u++){var o=f[u+1];if(o.length>0){a[n[u].substring(2)]=f[u+1].substring(1)}}return a}return f.slice(1)}}function T(e,t){var n;return function(){clearTimeout(n);n=setTimeout(e,t)}}function E(e){y=T(z,1);c[i](a,y);c[i](u,y);s[i](v,D);if(e){z(true)}}function P(){this.$=[];e(this);m.on("stop",this.s.bind(this));m.on("emit",this.e.bind(this))}function _(e){return e.replace(/^\/|\/$/,"")}function j(e){return typeof e=="string"}function k(e){return(e||p.href).replace(n,"")}function q(e){return w[0]==="#"?(e||p.href||"").split(w)[1]||"":(p?k(e):e||"").replace(w,"")}function z(t){var e=K===0;if(l<=K){return}K++;x.push(function(){var e=q();if(t||e!==A){m[o]("emit",e);A=e}});if(e){var n;while(n=x.shift()){n()}K=0}}function D(e){if(e.which!==1||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented){return}var t=e.target;while(t&&t.nodeName!=="A"){t=t.parentNode}if(!t||t.nodeName!=="A"||t[f]("download")||!t[f]("href")||t.target&&t.target!=="_self"||t.href.indexOf(p.href.match(n)[0])===-1){return}if(t.href!==p.href&&(t.href.split("#")[0]===p.href.split("#")[0]||w[0]!=="#"&&k(t.href).indexOf(w)!==0||w[0]==="#"&&t.href.split(w)[0]!==p.href.split(w)[0]||!L(q(t.href),t.title||s.title))){return}e.preventDefault()}function L(e,t,n){if(!h){return m[o]("emit",q(e))}e=w+_(e);t=t||s.title;n?h.replaceState(null,t,e):h.pushState(null,t,e);s.title=t;b=false;z();return b}d.m=function(e,t,n){if(j(e)&&(!t||j(t))){L(e,t,n||false)}else if(t){this.r(e,t)}else{this.r("@",e)}};d.s=function(){this.off("*");this.$=[]};d.e=function(n){this.$.concat("@").some(function(e){var t=(e==="@"?$:S)(_(n),_(e));if(typeof t!="undefined"){this[o].apply(null,[e].concat(t));return b=true}},this)};d.r=function(e,t){if(e!=="@"){e="/"+_(e);this.$.push(e)}this.on(e,t)};var R=new P;var Z=R.m.bind(R);Z.create=function(){var e=new P;var t=e.m.bind(e);t.stop=e.s.bind(e);return t};Z.base=function(e){w=e||"#";A=q()};Z.exec=function(){z(true)};Z.parser=function(e,t){if(!e&&!t){$=N;S=O}if(e){$=e}if(t){S=t}};Z.query=function(){var r={};var e=p.href||A;e.replace(/[?&](.+?)=([^&]*)/g,function(e,t,n){r[t]=n});return r};Z.stop=function(){if(g){if(c){c[r](a,y);c[r](u,y);s[r](v,D)}m[o]("stop");g=false}};Z.start=function(e){if(!g){if(c){if(document.readyState==="interactive"||document.readyState==="complete"){E(e)}else{document.onreadystatechange=function(){if(document.readyState==="interactive"){setTimeout(function(){E(e)},1)}}}}g=true}};Z.base();Z.parser();return Z});